{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mukki\\\\Documents\\\\workspace\\\\chaingames\\\\battleBoard\\\\client\\\\src\\\\views\\\\auth\\\\LoginView\\\\JWTLogin.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport clsx from 'clsx';\nimport { useHistory } from 'react-router-dom';\nimport * as Yup from 'yup';\nimport PropTypes from 'prop-types';\nimport { Formik } from 'formik';\nimport { Box, Button, FormHelperText, TextField, makeStyles } from '@material-ui/core';\nimport { Alert } from '@material-ui/lab';\nimport useAuth from 'src/hooks/useAuth';\nimport useIsMountedRef from 'src/hooks/useIsMountedRef'; // new\n\nimport ReCAPTCHA from 'react-google-recaptcha';\nimport { useEffect, useState, useContext } from 'react'; //import { useRouter } from 'next/router'\n\nimport { loginService } from '../../../service/node.service.js';\nimport { SignUpRedirectURL, ForgotPasswordRedirectURL, RecaptchaSiteKey } from '../../../config/constants';\nimport { AuthContext } from '../../../context/AuthContext';\nimport { LOGIN_REQUEST } from '../../../actions/actions';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(() => ({\n  root: {}\n}));\n\nconst JWTLogin = ({\n  className,\n  ...rest\n}) => {\n  _s();\n\n  const classes = useStyles();\n  const {\n    login\n  } = useAuth();\n  const isMountedRef = useIsMountedRef(); // new\n\n  const history = useHistory();\n  const {\n    dispatch\n  } = useContext(AuthContext);\n  const [userNameFocus, setUserNameFocus] = useState();\n  const [passwordFocus, setPasswordFocus] = useState();\n  const [userName, setUserName] = useState('');\n  const [password, setPassword] = useState('');\n  const [errMsg, setErrMsg] = useState();\n  const recaptchaRef = React.useRef();\n  const [captchaVerified, setCaptchaVerified] = useState(false);\n  const [captchaToken, setCaptchaToken] = useState();\n\n  const onCaptchaChange = value => {\n    setCaptchaVerified(value ? true : false);\n    setCaptchaToken(value);\n  };\n\n  useEffect(() => {\n    document.documentElement.scrollTop = 0;\n    document.scrollingElement.scrollTop = 0;\n    document.body.classList.add(\"login-page\");\n  }, []);\n\n  async function onLoginButtonClick(e) {\n    setErrMsg('');\n    e.preventDefault();\n\n    if (userName && password && captchaVerified) {\n      try {\n        let formData = {\n          username: userName,\n          reCaptchaToken: captchaToken,\n          password\n        };\n        const response = await loginService(formData);\n        const data = response.data;\n\n        if (data.success === true) {\n          dispatch({\n            type: LOGIN_REQUEST,\n            payload: { ...data\n            }\n          });\n\n          if (redirect) {\n            router.push(redirect);\n          } else {\n            router.push('/dashboard');\n          }\n        } else {\n          setErrMsg('Something went wrong. Please try again');\n        }\n      } catch (error) {\n        console.log(\"onLoginButtonClick -> error\", error);\n        recaptchaRef.current.reset();\n\n        if (error.response) {\n          setErrMsg(error.response.data.error);\n        }\n      }\n    } else if (!userName) {\n      setErrMsg('Please enter User Name');\n    } else if (!password) {\n      setErrMsg('Please enter Password');\n    } else if (!captchaVerified) {\n      setErrMsg('Please complete Captcha');\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(Formik, {\n    initialValues: {\n      email: 'mukki@chaingames.io',\n      password: 'Password123',\n      submit: null\n    },\n    validationSchema: Yup.object().shape({\n      //email: Yup.string().email('Must be a valid email').max(255).required('Email is required'),\n      password: Yup.string().max(255).required('Password is required')\n    }),\n    onSubmit: async (values, {\n      setErrors,\n      setStatus,\n      setSubmitting\n    }) => {\n      try {\n        let formData = {\n          username: values.email,\n          reCaptchaToken: ' ',\n          password: values.password\n        };\n        const response = await loginService(formData);\n        console.log(response);\n\n        if (isMountedRef.current) {\n          setStatus({\n            success: true\n          });\n          setSubmitting(false);\n        }\n\n        const data = response.data;\n\n        if (data.success === true) {\n          dispatch({\n            type: LOGIN_REQUEST,\n            payload: { ...data\n            }\n          });\n          router.push('/dashboard');\n          console.log('######## LOGIN SUCCESS! ########');\n        } else {\n          setErrMsg('Something went wrong. Please try again');\n          console.log('######## LOGIN ERROR! ########');\n        }\n      } catch (error) {\n        console.log('++++++++');\n        console.error(error);\n\n        if (isMountedRef.current) {\n          setStatus({\n            success: false\n          });\n          setErrors({\n            submit: error.message\n          });\n          setSubmitting(false);\n        }\n\n        console.log(\"onLoginButtonClick -> error\", error);\n        recaptchaRef.current.reset();\n\n        if (error.response) {\n          setErrMsg(error.response.data.error);\n        }\n      }\n    },\n    children: ({\n      errors,\n      handleBlur,\n      handleChange,\n      handleSubmit,\n      isSubmitting,\n      touched,\n      values\n    }) => /*#__PURE__*/_jsxDEV(\"form\", {\n      noValidate: true,\n      onSubmit: handleSubmit,\n      className: clsx(classes.root, className),\n      ...rest,\n      children: [/*#__PURE__*/_jsxDEV(TextField, {\n        error: Boolean(touched.email && errors.email),\n        fullWidth: true,\n        autoFocus: true,\n        helperText: touched.email && errors.email,\n        label: \"Email Address\",\n        margin: \"normal\",\n        name: \"email\",\n        onBlur: handleBlur,\n        onChange: handleChange,\n        type: \"email\",\n        value: values.email,\n        variant: \"outlined\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(TextField, {\n        error: Boolean(touched.password && errors.password),\n        fullWidth: true,\n        helperText: touched.password && errors.password,\n        label: \"Password\",\n        margin: \"normal\",\n        name: \"password\",\n        onBlur: handleBlur,\n        onChange: handleChange,\n        type: \"password\",\n        value: values.password,\n        variant: \"outlined\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 11\n      }, this), errors.submit && /*#__PURE__*/_jsxDEV(Box, {\n        mt: 3,\n        children: /*#__PURE__*/_jsxDEV(FormHelperText, {\n          error: true,\n          children: errors.submit\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        mt: 2,\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          color: \"secondary\",\n          disabled: isSubmitting,\n          fullWidth: true,\n          size: \"large\",\n          type: \"submit\",\n          variant: \"contained\",\n          children: \"Log In\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        mt: 2,\n        children: /*#__PURE__*/_jsxDEV(Alert, {\n          severity: \"info\",\n          children: \"Wrong Username or Password\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 113,\n    columnNumber: 5\n  }, this);\n};\n\n_s(JWTLogin, \"bBNzuhFegTv8bSv+0m8CCB6zyPo=\", false, function () {\n  return [useStyles, useAuth, useIsMountedRef, useHistory];\n});\n\n_c = JWTLogin;\nJWTLogin.propTypes = {\n  className: PropTypes.string\n};\nexport default JWTLogin;\n\nvar _c;\n\n$RefreshReg$(_c, \"JWTLogin\");","map":{"version":3,"sources":["C:/Users/mukki/Documents/workspace/chaingames/battleBoard/client/src/views/auth/LoginView/JWTLogin.js"],"names":["React","clsx","useHistory","Yup","PropTypes","Formik","Box","Button","FormHelperText","TextField","makeStyles","Alert","useAuth","useIsMountedRef","ReCAPTCHA","useEffect","useState","useContext","loginService","SignUpRedirectURL","ForgotPasswordRedirectURL","RecaptchaSiteKey","AuthContext","LOGIN_REQUEST","useStyles","root","JWTLogin","className","rest","classes","login","isMountedRef","history","dispatch","userNameFocus","setUserNameFocus","passwordFocus","setPasswordFocus","userName","setUserName","password","setPassword","errMsg","setErrMsg","recaptchaRef","useRef","captchaVerified","setCaptchaVerified","captchaToken","setCaptchaToken","onCaptchaChange","value","document","documentElement","scrollTop","scrollingElement","body","classList","add","onLoginButtonClick","e","preventDefault","formData","username","reCaptchaToken","response","data","success","type","payload","redirect","router","push","error","console","log","current","reset","email","submit","object","shape","string","max","required","values","setErrors","setStatus","setSubmitting","message","errors","handleBlur","handleChange","handleSubmit","isSubmitting","touched","Boolean","propTypes"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport clsx from 'clsx';\r\nimport { useHistory } from 'react-router-dom';\r\nimport * as Yup from 'yup';\r\nimport PropTypes from 'prop-types';\r\nimport { Formik } from 'formik';\r\nimport {\r\n  Box,\r\n  Button,\r\n  FormHelperText,\r\n  TextField,\r\n  makeStyles\r\n} from '@material-ui/core';\r\nimport { Alert } from '@material-ui/lab';\r\nimport useAuth from 'src/hooks/useAuth';\r\nimport useIsMountedRef from 'src/hooks/useIsMountedRef';\r\n\r\n// new\r\nimport ReCAPTCHA from 'react-google-recaptcha';\r\nimport { useEffect, useState, useContext } from 'react';\r\n//import { useRouter } from 'next/router'\r\nimport { loginService } from '../../../service/node.service.js';\r\nimport { SignUpRedirectURL, ForgotPasswordRedirectURL, RecaptchaSiteKey } from '../../../config/constants';\r\nimport { AuthContext } from '../../../context/AuthContext';\r\nimport { LOGIN_REQUEST } from '../../../actions/actions';\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  root: {}\r\n}));\r\n\r\nconst JWTLogin = ({ className, ...rest }) => {\r\n  const classes = useStyles();\r\n  const { login } = useAuth();\r\n  const isMountedRef = useIsMountedRef();\r\n\r\n  // new\r\n  const history = useHistory();\r\n  const {dispatch} = useContext(AuthContext);\r\n  const [userNameFocus, setUserNameFocus] = useState()\r\n  const [passwordFocus, setPasswordFocus] = useState()\r\n  const [userName, setUserName] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [errMsg, setErrMsg] = useState()\r\n  const recaptchaRef = React.useRef();\r\n  const [captchaVerified, setCaptchaVerified] = useState(false);\r\n  const [captchaToken, setCaptchaToken] = useState()\r\n\r\n  const onCaptchaChange = (value) => {\r\n    setCaptchaVerified(value ? true: false);\r\n    setCaptchaToken(value);\r\n  }\r\n\r\n  useEffect(() =>{\r\n    document.documentElement.scrollTop = 0;\r\n    document.scrollingElement.scrollTop = 0;\r\n    document.body.classList.add(\"login-page\");\r\n  }, [])\r\n\r\n  async function onLoginButtonClick(e){\r\n    setErrMsg('');\r\n    e.preventDefault()\r\n    if(userName && password && captchaVerified){\r\n      try{\r\n        let formData = {\r\n          username: userName,\r\n          reCaptchaToken: captchaToken,\r\n          password\r\n        };\r\n        \r\n        const response = await loginService(formData);\r\n        \r\n        const data = response.data;\r\n        if(data.success === true){\r\n          dispatch({\r\n            type: LOGIN_REQUEST,\r\n            payload: {\r\n              ...data,\r\n            }\r\n          })\r\n          if (redirect) {\r\n            router.push(redirect)\r\n          }\r\n          else {\r\n            router.push('/dashboard')\r\n          }\r\n        }\r\n        else{\r\n          setErrMsg('Something went wrong. Please try again');\r\n        }\r\n      }\r\n      catch(error){\r\n        console.log(\"onLoginButtonClick -> error\", error)\r\n        recaptchaRef.current.reset();\r\n\r\n        if(error.response){\r\n          setErrMsg(error.response.data.error);\r\n        }\r\n        \r\n      }\r\n    }\r\n    else if(!userName){\r\n      setErrMsg('Please enter User Name');\r\n    }\r\n    else if(!password){\r\n      setErrMsg('Please enter Password');\r\n    }\r\n    else if(!captchaVerified){\r\n      setErrMsg('Please complete Captcha');\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Formik\r\n      initialValues={{\r\n        email: 'mukki@chaingames.io',\r\n        password: 'Password123',\r\n        submit: null\r\n      }}\r\n      validationSchema={Yup.object().shape({\r\n        //email: Yup.string().email('Must be a valid email').max(255).required('Email is required'),\r\n        password: Yup.string().max(255).required('Password is required')\r\n      })}\r\n      onSubmit={async (values, {\r\n        setErrors,\r\n        setStatus,\r\n        setSubmitting\r\n      }) => {\r\n        try{\r\n          let formData = {\r\n            username: values.email,\r\n            reCaptchaToken: ' ',\r\n            password: values.password\r\n          };\r\n          \r\n          const response = await loginService(formData);\r\n\r\n          console.log(response)\r\n\r\n          if (isMountedRef.current) {\r\n            setStatus({ success: true });\r\n            setSubmitting(false);\r\n          }\r\n          \r\n          const data = response.data;\r\n          if(data.success === true){\r\n            dispatch({\r\n              type: LOGIN_REQUEST,\r\n              payload: {\r\n                ...data,\r\n              }\r\n            })\r\n            router.push('/dashboard')\r\n\r\n            console.log('######## LOGIN SUCCESS! ########')\r\n          }\r\n          else{\r\n            setErrMsg('Something went wrong. Please try again');\r\n            console.log('######## LOGIN ERROR! ########')\r\n          }\r\n        }\r\n        catch(error){\r\n          console.log('++++++++')\r\n          console.error(error);\r\n          if (isMountedRef.current) {\r\n            setStatus({ success: false });\r\n            setErrors({ submit: error.message });\r\n            setSubmitting(false);\r\n          }\r\n          \r\n          console.log(\"onLoginButtonClick -> error\", error)\r\n          recaptchaRef.current.reset();\r\n  \r\n          if(error.response){\r\n            setErrMsg(error.response.data.error);\r\n          }\r\n          \r\n        }\r\n      }}\r\n    >\r\n      {({\r\n        errors,\r\n        handleBlur,\r\n        handleChange,\r\n        handleSubmit,\r\n        isSubmitting,\r\n        touched,\r\n        values\r\n      }) => (\r\n        <form\r\n          noValidate\r\n          onSubmit={handleSubmit}\r\n          className={clsx(classes.root, className)}\r\n          {...rest}\r\n        >\r\n          <TextField\r\n            error={Boolean(touched.email && errors.email)}\r\n            fullWidth\r\n            autoFocus\r\n            helperText={touched.email && errors.email}\r\n            label=\"Email Address\"\r\n            margin=\"normal\"\r\n            name=\"email\"\r\n            onBlur={handleBlur}\r\n            onChange={handleChange}\r\n            type=\"email\"\r\n            value={values.email}\r\n            variant=\"outlined\"\r\n          />\r\n          <TextField\r\n            error={Boolean(touched.password && errors.password)}\r\n            fullWidth\r\n            helperText={touched.password && errors.password}\r\n            label=\"Password\"\r\n            margin=\"normal\"\r\n            name=\"password\"\r\n            onBlur={handleBlur}\r\n            onChange={handleChange}\r\n            type=\"password\"\r\n            value={values.password}\r\n            variant=\"outlined\"\r\n          />\r\n          {errors.submit && (\r\n            <Box mt={3}>\r\n              <FormHelperText error>\r\n                {errors.submit}\r\n              </FormHelperText>\r\n            </Box>\r\n          )}\r\n          <Box mt={2}>\r\n            <Button\r\n              color=\"secondary\"\r\n              disabled={isSubmitting}\r\n              fullWidth\r\n              size=\"large\"\r\n              type=\"submit\"\r\n              variant=\"contained\"\r\n            >\r\n              Log In\r\n            </Button>\r\n          </Box>\r\n          <Box mt={2}>\r\n            <Alert\r\n              severity=\"info\"\r\n            >\r\n              Wrong Username or Password\r\n            </Alert>\r\n          </Box>\r\n        </form>\r\n      )}\r\n    </Formik>\r\n  );\r\n};\r\n\r\nJWTLogin.propTypes = {\r\n  className: PropTypes.string,\r\n};\r\n\r\nexport default JWTLogin;\r\n"]},"metadata":{},"sourceType":"module"}